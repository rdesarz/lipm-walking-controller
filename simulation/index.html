
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../inverse_kinematics/">
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Integration in simulation - Biped Walking Controller</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integration-in-physical-simulator" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Biped Walking Controller" class="md-header__button md-logo" aria-label="Biped Walking Controller" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Biped Walking Controller
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Integration in simulation
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/rdesarz/biped-walking-controller.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Biped Walking Controller" class="md-nav__button md-logo" aria-label="Biped Walking Controller" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Biped Walking Controller
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/rdesarz/biped-walking-controller.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../preview_control/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zero-Moment Point (ZMP) Preview Controller
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../foot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Foot trajectory generation
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../inverse_kinematics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inverse kinematics
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Integration in simulation
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Integration in simulation
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Introduction
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      
        Example
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="integration-in-physical-simulator">Integration in physical simulator</h1>
<h2 id="introduction">Introduction</h2>
<p>The simulation module validates the entire walking control pipeline, from ZMP-based pattern generation to joint-space 
motion execution. It provides a reproducible environment to test the controller under realistic dynamics.
The robot is simulated in PyBullet, which integrates forward dynamics and computes contact forces during each support 
phase. The module reproduces the walking sequence defined by the preview controller, including single and double support 
phases, ZMP transitions, and foot exchanges. The reference trajectories of the center of mass (CoM) and feet are generated 
by the LIPM + preview control model, then projected into joint space through the inverse-kinematics solver based on Pinocchio.</p>
<p>At each timestep, the Pinocchio kinematic model is updated using the robot state from PyBullet. The desired joint 
positions are then computed and applied through position control, ensuring consistency between the kinematic model and the simulated robot.</p>
<h2 id="example">Example</h2>
<p>In this example, the controller and inverse-kinematics modules are integrated into PyBullet to test the walking pattern in a simulated environment.
The <code>xhost</code> command is only required if you want to display the GUI interface:</p>
<div class="highlight"><pre><span></span><code>xhost<span class="w"> </span>+local:root
docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-it<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--env<span class="w"> </span>DISPLAY<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-v<span class="w"> </span>/tmp/.X11-unix:/tmp/.X11-unix:ro<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--device<span class="w"> </span>/dev/dri:/dev/dri<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>ghcr.io/rdesarz/biped-walking-controller<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>python<span class="w"> </span>examples/example_4_physics_simulation.py<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--path-talos-data<span class="w"> </span><span class="s2">&quot;/&quot;</span><span class="w"> </span>--launch-gui<span class="w"> </span>--plot-results
</code></pre></div>
<p>You should get a visualization of the simulation such as the one below:</p>
<p align="center">
  <img src="../img/physics_simulation.gif" />
</p>

<p>At the end of the walking sequence, a plot should be displayed. It plots the position of the CoM and foot trajectories on x and y axis:</p>
<p><img alt="walking_x_y_plot.png" src="../img/walking_x_y_plot.png" /></p>
<h1 id="code-api">Code API</h1>
<p>The simulation module provides all components required to initialize and manage the physics simulation. It simplifies 
interaction with the robot, including data extraction and joint configuration. The Simulator class currently implements 
this interface using PyBullet as the physics backend.</p>


<div class="doc doc-object doc-module">



<a id="biped_walking_controller.simulation"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="biped_walking_controller.simulation.Simulator" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Simulator</span>


</h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">Simulator</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">path_to_robot_urdf</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">launch_gui</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_solver_iter</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



        <p>Thin PyBullet wrapper for loading a robot URDF and driving it from
joint positions/velocities. Also exposes utilities for camera control,
contact-force/ZMP computation, and setter/getter for joints configuration.
The robot is loaded at the origin and a flat horizontal plane is added at z=0.</p>

        <p>Initialize PyBullet, load ground and TALOS, and set physics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dt</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fixed simulation time step in seconds.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_to_robot_urdf</code>
            </td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base path containing the URDF data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Pinocchio model container used to build pb↔pin joint maps.
Must expose <code>model</code> for velocity map construction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>launch_gui</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, starts PyBullet with GUI. Otherwise uses DIRECT mode.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="side-effects" open>
  <summary>Side Effects</summary>
  <ul>
<li>Connects to PyBullet and configures gravity, time step, and engine params.</li>
<li>Loads a plane and the TALOS robot in the world.</li>
<li>Builds maps from PyBullet joint indices to Pinocchio q/v indices.</li>
</ul>
</details>










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.step" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">step</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">step</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Advance the physics simulation by one fixed time step.</p>


<details class="note" open>
  <summary>Notes</summary>
  <p>Uses the engine time step configured in <code>__init__</code>.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.reset_robot_configuration" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">reset_robot_configuration</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">reset_robot_configuration</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Hard-reset robot state from a configuration vector.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code>(<span title="numpy.ndarray">ndarray</span>, <span title="shape">shape</span>(<span title="nq">nq</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Full Pinocchio configuration, including free-flyer (7).
Applied to PyBullet base + joints via helper mapping.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.apply_joints_pos_to_robot" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply_joints_pos_to_robot</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_joints_pos_to_robot</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Send position targets to PyBullet joint position controllers.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>q</code>
            </td>
            <td>
                  <code>(<span title="numpy.ndarray">ndarray</span>, <span title="shape">shape</span>(<span title="nq">nq</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired configuration in Pinocchio ordering.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.apply_joints_vel_to_robot" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">apply_joints_vel_to_robot</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">apply_joints_vel_to_robot</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Send joint-space velocity targets to the simulator.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code>(<span title="numpy.ndarray">ndarray</span>, <span title="shape">shape</span>(<span title="nv">nv</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired generalized velocities in Pinocchio ordering.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.get_q" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_q</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_q</span><span class="p">(</span><span class="n">nq</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Read the current configuration vector from PyBullet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nq</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total configuration size expected by Pinocchio.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>(<span title="numpy.ndarray">ndarray</span>, <span title="shape">shape</span>(<span title="nq">nq</span>))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration with base pose first (x,y,z, qw,qx,qy,qz), then joints.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.update_camera_to_follow_pos" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_camera_to_follow_pos</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">update_camera_to_follow_pos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Aim the debug camera at a world position.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target position in world frame for the camera to look at.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target position in world frame for the camera to look at.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>z</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target position in world frame for the camera to look at.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Keeps distance, yaw, and pitch fixed.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.get_contact_forces" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_contact_forces</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_contact_forces</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return the net x-axis contact forces for the right and left foot.</p>
<p>The method queries PyBullet for contacts between the robot and the ground
on each foot link, then uses the private helper <code>_compute_force(...)</code>
to aggregate the force component along the world x-axis.</p>


<details class="requirements" open>
  <summary>Requirements</summary>
  <ul>
<li><code>self.robot_id</code> : int
    PyBullet body id of the robot.</li>
<li><code>self.plane_id</code> : int
    PyBullet body id of the ground/plane.</li>
<li><code>self.rf_link_id</code> : int
    Link index of the right foot.</li>
<li><code>self.lf_link_id</code> : int
    Link index of the left foot.</li>
<li><code>_compute_force(contacts) -&gt; tuple[float, Any]</code>
    Helper that returns the x-axis force [N] as its first element.
    It should return 0.0 if <code>contacts</code> is empty.</li>
</ul>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>(<span title="float">float</span>, <span title="float">float</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p><code>(Fx_right, Fx_left)</code> in Newtons, world frame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>Only contacts with <code>bodyA=self.robot_id</code>, <code>bodyB=self.plane_id</code>,
  and <code>linkIndexA</code> equal to the corresponding foot link are considered.</li>
<li>If a foot has no active contacts, its returned force is expected to be 0.0.</li>
<li>This method assumes <code>_compute_force</code> already applies the correct
  Newton third-law sign convention to yield the force exerted on the robot.</li>
</ul>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.draw_points" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">draw_points</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">draw_points</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">point_size</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Draw or update a set of debug points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td>
                  <code>(<span title="array">array</span> - <span title="like">like</span>, <span title="shape">shape</span>(<span title="N">N</span>, 3))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>World coordinates of points.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colors</code>
            </td>
            <td>
                  <code>(<span title="array">array</span> - <span title="like">like</span>, <span title="shape">shape</span>(<span title="N">N</span>, 3))</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>RGB colors in [0,1] per point.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>point_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Uses a persistent debug item so updates replace the existing set (for performance reasons)</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.get_robot_com_position" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_robot_com_position</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_robot_com_position</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Compute the whole-body center of mass in world coordinates.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[x, y, z] position of the CoM in the world frame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="method" open>
  <summary>Method</summary>
  <ul>
<li>Retrieves base inertial COM, then iterates articulated links.</li>
<li>Mass-weights each link COM and normalizes by total mass.</li>
</ul>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.get_robot_pos" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_robot_pos</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_robot_pos</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the floating base world pose.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="list">list</span>[<span title="float">float</span>], <span title="list">list</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(position [x,y,z], quaternion [x,y,z,w]) in world frame.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.get_robot_frame_pos" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_robot_frame_pos</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_robot_frame_pos</span><span class="p">(</span><span class="n">frame_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get world pose of a named link frame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>frame_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the link in the URDF.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="tuple">tuple</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="float">float</span>], <span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="float">float</span>, <span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(position, quaternion) of the link frame in world.
Uses PyBullet forward kinematics.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="KeyError">KeyError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If <code>frame_name</code> is not found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="biped_walking_controller.simulation.Simulator.get_zmp_pose" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_zmp_pose</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_zmp_pose</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Estimate the Zero-Moment Point using contact wrenches against the plane.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>[px, py, 0.0] in world if vertical force Fz != 0, else None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="method" open>
  <summary>Method</summary>
  <ul>
<li>Iterates robot–plane contact points.</li>
<li>Accumulates total contact force F and moment M about world origin
  using r × f at the contact position.</li>
<li>ZMP on the ground plane is computed as:
  px = -M_y / F_z,  py = M_x / F_z.</li>
</ul>
</details>

<details class="note" open>
  <summary>Notes</summary>
  <p>This assumes a flat ground at z=0 and uses only normal forces
reported by PyBullet at each contact.</p>
</details>

    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Romain Desarzens
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>